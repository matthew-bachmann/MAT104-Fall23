##Testing

---
title: "Introduction to R and RStudio"
output:
  html_document:
    css: /style.css
    toc: yes
    toc_float: yes
    theme: cosmo
  pdf_document:
    toc: yes
editor_options:
  chunk_output_type: console
---




```{r global_options, include = FALSE}
library(knitr)
library(datasets)
library(tidyverse)
knitr::opts_chunk$set(eval = TRUE, results = FALSE)
```



## The RStudio Interface

The goal of this lab is to introduce you to R and RStudio, which you’ll be using throughout the course both to learn the statistical concepts discussed in the course and to analyze real data and come to informed conclusions. To clarify which is which: **R** is the name of the programming language itself and **RStudio** is a convenient interface.

As the labs progress, you are encouraged to explore beyond what the labs dictate; a willingness to experiment will make you a much better programmer. Before we get to that stage, however, you need to build some basic fluency in R. Today we begin with the fundamental building blocks of R and RStudio: the interface, reading in data, and basic commands.


The panel on the left is where the action happens. It’s called the console. Every time you launch RStudio, it will have the same text at the top of the console telling you the version of R that you’re running. Below that information is the prompt. As its name suggests, this prompt is really a request: a request for a command. Initially, interacting with R is all about typing commands and interpreting the output. These commands and their syntax have evolved over decades (literally) and now provide what many users feel is a fairly natural way to access data and organize, describe, and invoke statistical computations.

The panel in the upper right contains your environment as well as a history of the commands that you’ve previously entered.

Any plots that you generate will show up in the panel in the lower right corner. This is also where you can browse your files, access help, manage packages, etc.

### R Packages

R is an open-source programming language, meaning that users can contribute packages that make our lives easier, and we can use them for free. For this lab, and many others in the future, we will use the following R packages:

- The suite of **tidyverse** packages: for data wrangling and data visualization
- **openintro**: for data and custom functions with the OpenIntro resources
- **gapminder**: for easy access to an excerpt of the Gapminder data on life expectancy, GDP per capita, and population by country
- **fivethirtyeight**: for access to data used in articles published on FiveThirtyEight.com

If these packages are not already available in your R environment, install them by typing the following three lines of code into the console of your RStudio session, pressing the enter/return key after each one. Note that you can check to see which packages (and which versions) are installed by inspecting the Packages tab in the lower right panel of RStudio.

```{r install-packages, message= FALSE,  eval=FALSE}
install.packages("tidyverse")
install.packages("openintro")
install.packages("gapminder")
install.packages("fivethirtyeight")
```


You may need to select a server from which to download; any of them will work. Next, you need to load these packages in your working environment. We do this with the <code>library</code> function. Run the following lines in your console.


```{r load-packages, message=FALSE}
library(tidyverse)
library(openintro)
library(gapminder)
library(fivethirtyeight)
```


You only need to *install* packages once, but you need to *load* them each time you relaunch RStudio.

The Tidyverse packages share common philosophies and are designed to work together. You can find more about the packages in the tidyverse at [https://www.tidyverse.org](https://www.tidyverse.org).

### R Markdown Reports

We will be using R Markdown to create reproducible reports. R Markdown allows you to combine your coding and data analysis with text describing and interpreting what you did. See the video below describing why and how:

[Why use R Markdown?](https://www.youtube.com/embed/lNWVQ2oxNho)

Going forward you should refrain from typing your code directly in the console (unless instructed to do so), and instead type any code (final correct answer, or anything you’re just trying out) in the R Markdown file and run the chunk using either the Run button on the chunk (green sideways triangle) or by highlighting the code and clicking Run on the top right corner of the R Markdown editor. If at any point you need to start over, you can Run All Chunks above the chunk you’re working in by clicking on the down arrow in the code chunk.

## Exploring the Gapminder Data

To get started, run the following command to load the data and save it to a local version called<code> dm </code>.

```{r}
gm <- gapminder::gapminder
```

You can run the command by:

- clicking on the green arrow at the top right of the code chunk in the R Markdown file
- putting your cursor on this line and clicking the **Run** button on the upper right corner of the pane
- holding <code>Ctrl-Shift-Enter</code>
- typing the code in the console

This command instructs R to load some data: the gapminder data set. You should see that the environment area in the upper righthand corner of the RStudio window now lists a data set called gm that has 1704 observations of 6 variables. As you interact with R, you will create a series of objects. Sometimes you load them as we have done here, and sometimes you create them yourself as the byproduct of a computation or some analysis you have performed.

We can view part of the data set by typing its name into the console.

```{r}
gm
```


However, printing the whole dataset in the console is not that useful. One advantage of RStudio is that it comes with a built-in data viewer. Click on the name gm in the Environment pane (upper right window) that lists the objects in your environment. This will bring up an alternative display of the data set in the Data Viewer (upper left window). You can close the data viewer by clicking on the x in the upper lefthand corner.

What you should see are seven columns of numbers, each row representing a different commbination of country and year: the first entry in each row is simply the row number (an index we can use to access the data from individual years if we want), the second is the country, followed by the continent in which the country is located, year, and the last three columns represent the life expectancy, population, and gross domestic product (GDP) per capita for that country in the given year, respectively. Use the scrollbar on the right side of the console window to examine the complete data set.

Note that the row numbers in the first column are not part of the data. R adds them as part of its printout to help you make visual comparisons. You can think of them as the index that you see on the left side of a spreadsheet. In fact, the comparison to a spreadsheet will generally be helpful. R has stored this data set in a kind of spreadsheet or table called a data frame.

You can see the dimensions of this data frame as well as the names of the variables and the first few observations by typing:


```{r}
glimpse(gm)
```

or

```{r}
head(gm)
```

It is better practice to type this command into your console, since it is not necessary code to include in your solution file.

We can see that there are 1704 observations and 6 variables in this dataset. The variable names are country, continent, year, lifeExp, pop, and gdpPercap. At this point, you might notice that many of the commands in R look a lot like functions from math class; that is, invoking R commands means supplying a function with some number of arguments. The <code>glimpse</code> command, for example, took a single argument, the name of a data frame.

## Further Exploration
Let’s start to examine the data a little more closely. We can access the data in a single column of a data frame separately using a command like

```{r eval=FALSE}
gm$continent
```

This command will only show the names of continents given in each row of the data set. The dollar sign basically says “go to the data frame that comes before me, and find the variable that comes after me”.

1. What command would you use to extract just the country names? Try it!

Notice that the way R has printed these data is different. When we looked at the complete data frame, we saw 1704 rows, one on each line of the display. These data are no longer structured in a table with other variables, so they are displayed one right after another. Objects that print out in this way are called vectors; they represent a set of numbers. R has added numbers in [brackets] along the left side of the printout to indicate locations within the vector. For example, Asia follows [1], indicating that Asia is the first entry in the vector. And if [43] starts a line, then that would mean the first item on that line would represent the 43rd entry in the vector.


### Data Visualization

R has some powerful functions for making graphics. We can create a simple plot of the life expectancy of each country per year with the command

```{r plot-lifeExp-vs-year}
ggplot(data = gm, aes(x = year, y = lifeExp)) + 
  geom_point()
```

We use the <code>ggplot()</code> function to build plots. If you run the plotting code in your console, you should see the plot appear under the Plots tab of the lower right panel of RStudio. Notice that the command above again looks like a function, this time with arguments separated by commas.

with <code>ggplot()</code>

- The first argument is always the dataset
- Next, you provide the variables from the dataset to be assigned to <code>aes</code>thetic elements of the plot, e.g. the x and the y axes. 
- Finally, you use another layer, separated by a <code>+</code> to specify the geometric object for the plot. Since we want to scatterplot, we use <code>geom_point()</code>

For instance, if you wanted to visualize the above plot using a line graph, you would replace <code>geom_point()</code> with <code>geom_line()</code>.

```{r plot-lifeExp-vs-year-line}
ggplot(data = gm, aes(x = year, y = lifeExp)) + 
  geom_line()
```


You might wonder how you are supposed to know the syntax for the <code>ggplot</code> function. Thankfully, R documents all of its functions extensively. To learn what a function does and its arguments that are available to you, just type in a question mark followed by the name of the function that you’re interested in. Try the following in your console:

```{r plot-help, tidy = FALSE}
?ggplot
```

Notice that the help file replaces the plot in the lower right panel. You can toggle between plots and help files using the tabs at the top of that panel.

1. Is there an apparent trend in life expectancy over the years? How would you describe it? (To ensure that your lab report is comprehensive, be sure to include the code needed to make the plot as well as your written interpretation.)


### R as a Big Calculator

Now, suppose we want to plot the overall GDP (not per capita) for each country over the years. To compute this, we could use the fact that R is really just a big calculator. We can type in mathematical expressions like

```{r cal-GDP}
8425333*779
```

to see the overall GDP of Afghanistan in 1952. We could repeat this for each country-year combination, but there is a faster way. If we mutliply the vector for population by that for GDP per capita, R will compute all products simultaneously.

```{r calc-GPD-vector}
gm$pop*gm$gdpPercap
```

What you will see are 1704 numbers (in that packed display, because we aren’t looking at a data frame here), each one representing the product we’re after. Take a look at a few of them and verify that they are right.

### Adding a New Variable to the Data

We’ll be using this new vector to generate some plots, so we’ll want to save it as a permanent column in our data frame.

```{r mutate}
gm <- gm %>%
  mutate(gdp = pop * gdpPercap)
```

The <code>%>%</code> operator is called the **piping** operator. It takes the output of the previous expression and pipes it into the first argument of the function in the following one. To continue our analogy with mathematical functions, <code>x %>% f(y)</code> is equivalent to <code>f(x, y)</code>.

::: {#boxedtext}

**A note on piping**: Note that we can read these two lines of code as the following: “Take the gm dataset and pipe it into the mutate function. Mutate the gm data set by creating a new variable called gdp that is the product of the variables called pop and gdpPercap. Then assign the resulting dataset to the object called gm, i.e. overwrite the old gm dataset with the new one containing the new variable.”

This is equivalent to going through each row and multiplying the pop and gdpPercap values for that country and year and recording that value in a new column called `gdp`.
:::

<div>

::: {#boxedtext}
**Where is the new variable**? When you make changes to variables in your dataset, click on the name of the dataset again to update it in the data viewer.
:::
</div>

You’ll see that there is now a new column called `gdp` that has been tacked on to the data frame. The special symbol `<-` performs an assignment, taking the output of one line of code and saving it into an object in your environment. In this case, you already have an object called `gm`, so this command updates that data set with the new mutated column. You can make a scatter plot of the gdp for each country per year with the command

```{r plot-bdp}
ggplot(data = gm, aes(x = year, y = gdp)) + 
  geom_point()
```


Finally, in addition to simple mathematical operators like subtraction and division, you can ask R to make comparisons like greater than, `>`, less than, `<`, and equality, `==`. For example, we can ask if the population of a country exceeds 1,000,000 in each year with the expression

```{r calc-mutate}
gm <- gm %>%
  mutate(pop_over_1mil = pop > 1000000)
```


This command adds a new variable to the gm dataframe containing the values of either `TRUE` if that country had a population over 1,000,000 in a given year, or `FALSE` if not (the answer may surprise you). This variable contains a different kind of data than we have encountered so far. All other columns in the gm data frame have values that are numerical (the year, the population, the life expectancy, the GDP per capita) or character (the name of a country or continent). Here, we’ve asked R to create logical data, data where the values are either `TRUE` or `FALSE`. In general, data analysis will involve many different kinds of data types, and one reason for using R is that it is able to represent and compute with many of them.

## Resources for R and RStudio

That was a short introduction to R and RStudio, but we will provide you with more functions and a more complete sense of the language as the course progresses. In this course we will be using the suite of R packages from the **tidyverse**. The book [R For Data Science](https://r4ds.had.co.nz/) by Grolemund and Wickham is a fantastic resource for data analysis in R with the tidyverse. If you are googling for R code, make sureto also include these package names in your search query. For example, instead of googling “scatterplot in R”, google “scatterplot in R with the tidyverse”.

These may come in handy throughout the semester:

-   [RMarkdown cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)
-   [Data transformation cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)
-   [Data visualization cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)

Note that some of the code on these cheatsheets may be too advanced for this course. However the majority of it will become useful throughout the semester.

------------------------------------------------------------------------

This is a product of OpenIntro that is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. This lab was adapted for OpenIntro by Andrew Bray and Mine Çetinkaya-Rundel from a lab written by Mark Hansen of UCLA Statistics. It has been further adapted by Che Smith and Jason Byers for courses at Davidson College.

